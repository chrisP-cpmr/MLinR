---
title: "MPM Group Project - AirBnb Price Prediction"
author: "Giedo, Micha, Azher, Christoph"
date: "4/25/2021"
output: html_document
---

# Description of the Project

In this report, our group analyses the influence of different predictors on the 
listing price of AirBnb offerings in different cites in the United States.

The final model should provide a way to estimate the correct price for any new or existing 
object listed on AirBnB in order to ensure high booking rates. Also, it ensures
users of this model to not underprice their object and lose out on improved margins.
Please keep in mind, this model does not take into consideration the exact location
or 'cleanness' of an object due to a lack of data. However, both of these predictors
would have a high influence. Meaning, you apartment most likely still 
needs to be clean to result in a high booking rate.

# Data Preparation

As a first step, we load the data from our source .csv file and set all categorical
values to be considered as factors. We also load the packages required to execute
all our functions and calculations.

```{r include=FALSE}

library(ggplot2)
library(plyr)
library(multcomp)
library(splines)
library(faraway)
library(dplyr)
library(caret)
library(tidyverse)
library(neuralnet)

df.airbnb <- read.csv("MPM_Prop.csv")

df.airbnb$property_type <- as.factor(df.airbnb$property_type)
df.airbnb$room_type <- as.factor(df.airbnb$room_type)
df.airbnb$bed_type <- as.factor(df.airbnb$bed_type)
df.airbnb$cancellation_policy <- as.factor(df.airbnb$cancellation_policy)
df.airbnb$cleaning_fee <- as.factor(df.airbnb$cleaning_fee)
df.airbnb$city <- as.factor(df.airbnb$city)
df.airbnb$city <- as.factor(df.airbnb$city)
df.airbnb$host_has_profile_pic <- as.factor(df.airbnb$host_has_profile_pic)
df.airbnb$host_identity_verified <- as.factor(df.airbnb$host_identity_verified)
df.airbnb$instant_bookable <- as.factor(df.airbnb$instant_bookable)
df.airbnb$amenities_Breakfast <- as.factor(df.airbnb$amenities_Breakfast)
df.airbnb$amenities_Gym <- as.factor(df.airbnb$amenities_Gym)
df.airbnb$amenities_Pets <- as.factor(df.airbnb$amenities_Pets)
df.airbnb$amenities_WiFi <- as.factor(df.airbnb$amenities_WiFi)
```

# Data Understanding / Data Analysis

Now we will take a deeper look at our data, the response variable log_price 
and all the available predictors.

Lets look at all the predictors of our data set.

```{r include=FALSE}
unneeded_col <- c("X", "Unnamed..0")
df.airbnb <- df.airbnb[, ! names(df.airbnb) %in% unneeded_col, drop = F]
```

```{r}
colnames(df.airbnb)
```

We can see, our data set consists of a response variable and 19 predictors.
The column name
With a few simple commands, a better understanding of the values can be gained.

```{r}
head(df.airbnb)
```
Head provides an overview over the first 5 entries in the table, this provides
us with some knowledge about how the rows look.

```{r}
summary(df.airbnb)
``` 

The summary() command provides a first statistical overview of the data.

```{r}
str(df.airbnb)
```

And str() indicates the type of the variables.
Form this we can conclude, our target variable is a continuous variable, as 
predictors we have one continuous variable (number_of_reviews), 13 categorical
variables most with two levels but also some with five or 6, one binomial
variable (review_scores_rating) and four count variables.

# Defining the Measure of Fit and Cross Validation Approach

In order to have a consistent evaluation of our models and cross validate all our
models in the same way, the measure of fit as well as the cross validation approach
will be explained in this section.

For the measure of fit we choose the Root Mean Squared Error (RMSE) as it is easy
to understand and also easily applied.

For the cross validation, we will use a 10-fold approach. Meaning, we will split 
our data into 10 groups of equal size and randomly assigned observations. When testing,
every model will run at least once with every combination of test and train data
combination.

## Fitting a linear Model




## Applying the Possion Distribution

As our response variable is a continuous variable, we cannot apply the Poisson distribution to it. To show how this would work, we are going to consider another variable as a response variable.

For this example, we choose the variable 'accommodates' where we want to determine
if some predictors influence the size of the object to rent. Obviously, this is pretty clear for some predictors. If the object accommodates more there are most likely to be more beds. Hence this should really only be regarded as an example of applying the Possion distribution.

Lets first create a simple model and see the result.

```{r}
glm.accommodates.3 <- glm(accommodates ~ city, 
                          family = "poisson",
                          data = df.airbnb)

summary(glm.accommodates.3)
```

----- add explenation

Lets simulate the data and put it into a boxplot.

```{r}
set.seed(522)
sim.data.accommodates.Poisson <- simulate(glm.accommodates.3)

ggplot(mapping = aes(y = sim.data.accommodates.Poisson$sim_1,
                     x = df.airbnb$city)) +
  geom_boxplot() +
  geom_hline(yintercept = 0) +
  ylab("accomodates") +
  xlab("city")
```

---- add explenation 

Lets now create a complex model.

```{r}
glm.accommodates.4 <- glm(accommodates ~ city + property_type + log_price + 
                            property_type * city,
                          family = "poisson",
                          data = df.airbnb)
```

To check which model fits better, we will run a 10-fold cross validation check.

```{r}
set.seed(544)
r.squared.simple <- c()
r.squared.complex <- c()
# shuffle data
df.airbnb <- df.airbnb[sample(nrow(df.airbnb)),]
folds <- cut(seq(1,nrow(df.airbnb)), breaks = 10, labels = FALSE)
for(i in 1:10){
  testIndexes <- which(folds==i, arr.ind = TRUE)
  df.airbnb.test <- df.airbnb[testIndexes, ]
  df.airbnb.train <- df.airbnb[-testIndexes, ]
  ## insert your models - simple
  # fit the model with test data
  model.1.train <- glm(formula = formula(glm.accommodates.3),
                       data = df.airbnb.train)
  # predict the model
  predicted.model.1.test <- predict(model.1.train,
                                    newdata = df.airbnb.test)
  # compute R^2
  r.squared.simple[i] <- cor(predicted.model.1.test, 
                             df.airbnb.test$accommodates)^2
  ## insert you model - complex
  # fit the model with test data
  model.2.train <- glm(formula = formula(glm.accommodates.4),
                       data = df.airbnb.train)
  # predict the model
  predicted.model.2.test <- predict(model.2.train,
                                    newdata = df.airbnb.test)
  # compute R^2
  r.squared.complex <- cor(predicted.model.2.test, 
                           df.airbnb.test$accommodates)^2
}

mean(r.squared.simple)
mean(r.squared.complex)
```

From the results we can see, the simpler model fits much better and should therefore be considered. Again, this only an example to show the application of a Poisson model.



## Applying the Binomial Distribution



## Applying a GAM

```{r}

```

## Using the Support Vector Machines



## Using a Neural Network




## Using an Approximate Bayesian Computation



## Comparing the best Models of each Class



# Conclusion and Model Selection
